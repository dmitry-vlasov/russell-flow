import script/script;

main() {
	println(ruParseScScript("print \" AAaa dsfds\";"));

	scripts_dir = pathCombine(getRussellDir(), "scripts");
	//println("scripts_dir: " + scripts_dir);
	iter(readDirectory(scripts_dir),
		\file -> if (endsWith(file, ".rus")) {
			//println("observing: " + file);
			script_src = getFileContent(pathCombine(scripts_dir, file));

			maybeApply(
				ruParseScScript(script_src),
				\script -> {
					println("Script " + file + ":\n" + ruScScript2s(script) + "\n\n\n");

					json_script = ruScScript2Json(script);
					mscript1 = ruJson2ScScript(json_script);
					if (isNone(mscript1)) {
						println("json <-> script fails (1)");
						println(json2string(json_script));
						quit(0);
					} else {
						maybeApply(mscript1, \script1 ->
							if (ruScScript2s(script) != ruScScript2s(script1)) {
								println("json <-> script fails (2)");
								println("script_0: \n" + ruScScript2s(script) + "\n\n");
								println("script_1: \n" + ruScScript2s(script1) + "\n\n");
								quit(0);
							}
						);
					}
				}
			);
		} else {
			//println("non-script: " + file);
		}
	)
}