import ru/math;
import script/script;

export {
	RuTarget ::= RuTargetMath, RuTargetSource, RuTargetAssertion, RuTargetNone;
		RuTargetNone();
		RuTargetMath();
		RuTargetSource(source : RuSource);
		RuTargetAssertion(assertion : RuDecl);
	
	ruDetermineTarget(task : ScTask, math : RuMath, conf : RuConf) -> RuTarget;
}

ruDetermineTarget(task : ScTask, math : RuMath, conf : RuConf) -> RuTarget {
	target0 = lookupTreeDef(task.args, "target", "");
	if (target0 == "") RuTargetNone() else {
		target = ruTrimPath(target0, conf, ".ru");
		//if (ruVerbose(conf) > 0) {
		//	conf.onMessage("repoving target: '" + target + "'");
		//}
		if (target == "all" || target == "1" || target == "math") {
			RuTargetMath();
		} else {
			target_id = s2id(target);
			switch (lookupTree(math.sources, target_id)) {
				Some(src): RuTargetSource(src);
				None(): 
					switch (lookupTree(math.decls.assertions, target_id)) {
						Some(ass): RuTargetAssertion(ass);
						None(): RuTargetNone();
					}
			}
		}
	}
}