import ru/refactor/split_math;
import ru/refactor/optimize_imports;
import ru/refactor/refactor;
import ru/refactor/shorten;
import ru/refactor/generalize;
import ru/refactor/remove_less_general;
import command;

export {
	ruRefactorCommands() -> [RuComm];
}

ruRefactorCommands() -> [RuComm] {[
	ruApplyToProjectRoots(RuComm(
		"split-math", "misc", "split a single file into a filesystem", "file",
		[RuCommArg("file", false, "input file", "")],
		\task, env -> {
			file = lookupTreeDef(task.args, "file", "");
			module = ruTrimPath(file, env.conf, ".ru");
			RuEnv(env with ruMath = ruSplitMath(env.ruMath, env.conf, module));
		}
	)),
	RuComm(
		"fix-left-recursion", "misc", "make all grammar rules non-left-recursive", "", [],
		\task, env -> RuEnv(env with ruMath = ruFixLeftRecursiveRules(env.ruMath, env.conf))
	),
	RuComm(
		"optimize-imports", "misc", "optimize imports", "", [],
		\task, env -> RuEnv(env with ruMath = ruOptimizeImports(env.ruMath, env.conf))
	),
	RuComm(
		"shorten-proofs", "refactor", "try to make proofs shorter", "target",
		[RuCommArg("target", false, "the target: a theorem, file or all", "")],
		ruCommShortenProofs
	),
	RuComm(
		"remove-duplicate-steps", "refactor", "self evident", "target",
		[RuCommArg("target", false, "the target: a theorem, file or all", "")],
		ruCommRemoveMathDuplicateSteps
	),
	RuComm(
		"remove-unused-steps", "refactor", "self evident", "target",
		[RuCommArg("target", false, "the target: a theorem, file or all", "")],
		ruCommRemoveMathUnusedSteps
	),
	RuComm(
		"generalize", "refactor", "generalize entities", "target",
		[
			RuCommArg("file", true, "input file", ""),
			RuCommArg("target", true, "the target: a theorem, file or all", ""),
			RuCommArg("level", true, "generalization level: 0, 1, 2. Default is 0", "")
		],
		ruCommGeneralize
	),
	RuComm(
		"gen", "refactor", "shortcut for 'generalize'", "target",
		[
			RuCommArg("file", true, "input file", ""),
			RuCommArg("target", true, "the target: a theorem, file or all", ""),
			RuCommArg("level", true, "generalization level: 0, 1, 2. Default is 0", "")
		],
		ruCommGeneralize
	),
	RuComm(
		"remove-less-general", "refactor", "removes those assertions, which are less general then some others", "", [],
		ruCommRemoveLessGeneral
	),
]}
