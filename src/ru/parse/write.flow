import ru/update;

export {
	ruWriteSource(src : RuSource, math : RuMath, conf : RuConf) -> void;
}

ruWriteSource(src : RuSource, math : RuMath, conf : RuConf) -> void {
	path = src.info.path;
	ensureDirectoryExists(ruDirName(path));
	ext = ltrim2(getFileExt(path), ".");
	if (!setFileContent(src.info.path, ru2s(src, math.rules))) {
		conf.onMessage("failed to save file: '" + path + "'");
	} else {
		if (conf.verbose >= 2) {
			conf.onMessage("\t" + ext + " has written : '" + path + "'");
		}
	}
	ruToCache(ruUpdateSourcePositions(src, conf), conf);
}
