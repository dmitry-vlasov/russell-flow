import base/script;

main() {
	scripts_dir = pathCombine(getRussellDir(), "scripts");
	//println("scripts_dir: " + scripts_dir);
	iter(readDirectory(scripts_dir),
		\file -> if (endsWith(file, ".rus")) {
			//println("observing: " + file);
			script_src = getFileContent(pathCombine(scripts_dir, file));

			script = ruParseScript(script_src);
			println("Script " + file + ":\n" + ruScript2s(script) + "\n\n\n");

			json_script = ruScript2Json(script);
			mscript1 = ruJson2Script(json_script);
			if (isNone(mscript1)) {
				println("json <-> script fails (1)");
				quit(0);
			} else {
				maybeApply(mscript1, \script1 ->
					if (ruScript2s(script) != ruScript2s(script1)) {
						println("json <-> script fails (2)");
						println("script_0: \n" + ruScript2s(script) + "\n\n");
						println("script_1: \n" + ruScript2s(script1) + "\n\n");
						quit(0);
					}
				);
			}

		} else {
			//println("non-script: " + file);
		}
	)
}