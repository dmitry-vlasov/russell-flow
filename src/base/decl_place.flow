import base/ids;

export {
	RuDeclPlace(
		src : int, 
		pos : int
	);
	ruNoDeclPlace = RuDeclPlace(-1, -1);

	ruDeclPlace2s(place : RuDeclPlace) -> string;
	ruDeclPlaces2s(places : [RuDeclPlace]) -> string;
}

ruDeclPlace2s(place : RuDeclPlace) -> string {
	path = id2s(place.src);
	if (path == "") "" else {
		if (fileExists(path)) {
			if (place.pos == -1) {
				"file '" + path + "'";
			} else {
				code = getFileContent(path);
				resolver = makeLineResolver(code);
				pos = findLine(resolver, place.pos);
				"file '" + path + "': line " + i2s(pos.lineno) + ", col " + i2s(pos.column);
			}
		} else {
			"file '" + path + "' doesn't exist. Position is : " + i2s(place.pos);
		}
	}
}

ruDeclPlaces2s(places : [RuDeclPlace]) -> string {
	strGlue(map(places, ruDeclPlace2s), "\n");
}
