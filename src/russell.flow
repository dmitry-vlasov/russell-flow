import ru_conf_utils;
import ru_server;

main() -> void {
	if (getUrlParameterDef("server", "") != "lsp") {
		println("Russell prover (4th generation)");
		println("");
	}
	job = ruMakeJob(".", getAllUrlParametersArray());
	ruMakeCacheDir(job.conf);
	server = lookupTreeDef(job.conf.opts, "server", "");
	if (server == "http") {
		ruHttpServer(job.conf);
	} else if (server == "lsp") {
		ruConsoleServer(job.conf);
	} else if (server == "") {
		ruRun(job, \code -> {
			ruPrintln("processed in " + d2st((timestamp() - start)/ 1000.0, 2) + "s", job.conf);
			quit(0);
		});
	} else {
		ruPrintln("unsupported server mode: " + server, job.conf);
		quit(0);
	}
}
