import ru_server;

main() -> void {
	println("Russell prover (4th generation)");
	println("");
	switch (ruMakeConf(ruCurrentWorkingDir())) {
		Some(conf): {
			if (ruOptIsTrue("help", conf)) {
				ruUsage(conf);
				quit(0);
			} else if (ruOptIsTrue("http-server", conf)) {
				ruHttpServer(conf);
			} else if (ruOptIsTrue("console-server", conf)) {
				ruConsoleServer(conf);
			} else {
				ensureDirectoryExists(ruOpt("cache-dir", conf));
				start = timestamp();
				ruRun(conf, \code -> ruPrintln("processed in " + d2st((timestamp() - start)/ 1000.0, 2) + "s", conf));
				quit(0);
			}
		}
		None(): quit(0);
	}
}
