import sys/system;
import fs/filesystem;
import net/url_parameter;
import ds/set;
import ru_proc;

/*
../bin/russell verbose=1 caching=1 $file.mm mm-2-ru=1 ru-root=. ru-write-all=1 mm-stats=1 mm-fix=1 mm-split=1 ru-imports=1

../bin/russell verbose=1 caching=1 $file.ru mm=$file-1.mm ru-2-mm=1 ru-stats=1

../bin/metamath "read $file-1.mm" 'verify proof *' 'exit'
*/

main() -> void {
	file = getUrlParameter("file");
	file1 = ruRemoveExt(file, "mm");
	file_mm = resolveRelativePath(file);
	file_ru = file1 + ".ru";
	file_mm1 = file1 + "-1.mm";
	ensureDirectoryExists(ruDirName(file_mm));
	ruScript([
		"../bin/russell verbose=1 caching=1 " + file_mm + " mm-2-ru=1 ru-root=. ru-write-all=1 mm-stats=1 mm-fix=1 mm-split=1 ru-imports=1",
		"../bin/russell verbose=1 caching=1 " + file_ru + " mm=" + file_mm1 + " ru-2-mm=1 ru-stats=1",
		"../bin/metamath 'read " + file_mm1 + "' 'verify proof *' 'exit'"
	])
	(\-> { println("Chain of translations finished."); quit(0); });
}
